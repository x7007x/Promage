{% set page_title = "Admin Â· " + site.name %}
{% set meta = {
  "title": page_title,
  "description": "Admin panel for {{ site.title }}. Manage images, order, and monitor activity.",
  "url": site.base_url + "/admin",
  "image": site.default_og_image
} %}
{% extends "base.html" %}
{% block content %}
<main class="pt-40 max-w-7xl mx-auto px-4 sm:px-6 pb-16">
  {% if state == "unclaimed" %}
  <div class="max-w-2xl rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
    <div class="text-2xl font-bold">Claim Admin</div>
    <p class="mt-2 text-neutral-600 dark:text-neutral-400">This admin panel is unclaimed. Claiming it will bind admin access to your current device session.</p>
    <form method="post" action="/admin/claim" class="mt-4">
      <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-5 py-2 text-base">Claim</button>
    </form>
  </div>
  {% elif state == "taken" %}
  <div class="max-w-2xl rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
    <div class="text-2xl font-bold">Admin Taken</div>
    <p class="mt-2 text-neutral-600 dark:text-neutral-400">The admin panel is already claimed by another device session.</p>
  </div>
  {% else %}
  <div class="grid gap-8 md:grid-cols-3">
    <div class="md:col-span-2 grid gap-6">
      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="text-xl font-semibold">Add Image</div>
        <form method="post" action="/admin/add" class="mt-4 grid gap-3">
          <input name="id" placeholder="id" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="title" placeholder="title" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="src" placeholder="src" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="alt" placeholder="alt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <textarea name="prompt" placeholder="prompt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2"></textarea>
          <textarea name="negative" placeholder="negative prompt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2"></textarea>
          <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-5 py-2 text-base">Add</button>
        </form>
      </div>

      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="text-xl font-semibold">Images</div>
        <div class="mt-4 grid gap-3">
          {% for item in items %}
          <div class="flex items-center justify-between gap-3 rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/70 p-3">
            <div class="flex items-center gap-3">
              <img src="{{ item.src }}" alt="{{ item.alt }}" class="w-16 h-12 object-cover rounded-md">
              <div>
                <div class="font-semibold">{{ item.title }}</div>
                <div class="text-sm text-neutral-600 dark:text-neutral-400">{{ item.id }}</div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <a href="/prompt?id={{ item.id }}" class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-1.5 text-sm">View</a>
              <form method="post" action="/admin/delete" onsubmit="return confirm('Delete this image?')">
                <input type="hidden" name="id" value="{{ item.id }}">
                <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-1.5 text-sm">Delete</button>
              </form>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="grid gap-6">
      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="text-xl font-semibold">Edit Image</div>
        <form method="post" action="/admin/update" class="mt-4 grid gap-3">
          <input name="id" placeholder="id" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="title" placeholder="title" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="src" placeholder="src" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <input name="alt" placeholder="alt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">
          <textarea name="prompt" placeholder="prompt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2"></textarea>
          <textarea name="negative" placeholder="negative prompt" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2"></textarea>
          <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-5 py-2 text-base">Update</button>
        </form>
      </div>

      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="text-xl font-semibold">Reorder</div>
        <form method="post" action="/admin/reorder" class="mt-4 grid gap-3">
          <textarea name="order" rows="2" class="rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-2">{% for item in items %}{{ item.id }}{% if not loop.last %},{% endif %}{% endfor %}</textarea>
          <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-5 py-2 text-base">Save Order</button>
        </form>
      </div>

      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="flex items-center justify-between">
          <div class="text-xl font-semibold">Admin Session</div>
          <form method="post" action="/admin/release">
            <button class="rounded-full border border-neutral-300 dark:border-neutral-700 bg-white/80 dark:bg-white/10 px-3 py-1.5 text-sm">Release</button>
          </form>
        </div>
      </div>

      <div class="rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-white/5 p-6">
        <div class="text-xl font-semibold">Activity</div>
        <div class="mt-3 grid gap-3 max-h-[420px] overflow-auto pr-1">
          {% for a in activities %}
          <div class="flex items-center justify-between rounded-xl border border-neutral-200 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/70 p-3">
            <div class="text-sm">{{ a.kind }}</div>
            <div class="text-xs text-neutral-500 dark:text-neutral-400">{{ a.ts }}</div>
          </div>
          {% else %}
          <div class="text-sm text-neutral-500 dark:text-neutral-400">No activity yet</div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</main>
{% endblock %}